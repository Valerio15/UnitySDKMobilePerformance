# Unity iOS Performance Monitor Plugin

This project demonstrates a Unity plugin for iOS that tracks CPU, GPU, and RAM usage. The plugin is written in Swift and integrated with Unity using C#. This project includes the Swift native plugin and a Unity scene that uses the plugin to display performance metrics.

## Overview

The plugin provides two main functions:
- `StartTracking`: Begins monitoring the CPU, GPU, and RAM usage.
- `StopTracking`: Stops monitoring and returns the collected performance data.

The Unity scene integrates this plugin, allowing users to start and stop performance monitoring via UI buttons. The results are displayed within the Unity scene.

## Features

- **iOS Plugin in Swift**: Monitors CPU, GPU, and RAM usage.
- **Unity Integration**: Easily start and stop performance tracking from within a Unity scene.
- **Dynamic Performance Display**: Show performance metrics directly in the Unity scene.

## Requirements

- Unity 2022.3.41f or later
- Xcode 15.4 or later
- iOS 15.0 or later
- Swift 5.3 or later

## Installation

### Setting Up the iOS Plugin

1. Clone or download this repository.
2. Open the `PerformanceMonitor` Swift project in Xcode.
3. Build the `PerformanceMonitor.framework`.
4. Copy the generated `PerformanceMonitor.framework` to your Unity project under `Assets/Plugins/iOS/`.

### Setting Up the Unity Project

1. Open the Unity project in the `Unity/` folder.
2. Ensure the `PerformanceMonitor.framework` is placed in `Assets/Plugins/iOS/`.
3. Open the Unity scene file located in `Assets/Scenes/PerformanceMonitorScene.unity`.

## Usage

### In Unity Editor

1. Open the `PerformanceMonitorScene` scene.
2. Press the **Play** button in Unity to start the scene.

### In the iOS App

1. Deploy the Unity project to an iOS device.
2. In the app, click the **Start** button to begin tracking CPU, GPU, and RAM usage.
3. Click the **Stop** button to stop tracking and display the collected performance data.
4. Use the **Spawn Entities** button to simulate load on the CPU, GPU, and RAM.

### Plugin Functions

- **StartTracking()**: Initiates performance monitoring. Called when the **Start** button is pressed.
- **StopTracking()**: Stops monitoring and returns the data as a formatted string. Called when the **Stop** button is pressed.

### UI Elements in Unity

- **Start Button**: Starts the tracking process.
- **Stop Button**: Stops tracking and displays the performance metrics.
- **Spawn Entities Button**: Spawns objects in the scene to increase CPU, GPU, and RAM usage for testing.

## Development

### iOS Plugin (Swift)

The iOS plugin is implemented in Swift within the `PerformanceMonitor.swift` file. The plugin uses system APIs to track CPU, GPU, and RAM usage and exposes these functionalities to Unity via C functions.

### Unity Integration (C#)

The Unity integration is handled in `PerformanceMonitorController.cs`, which communicates with the iOS plugin via `[DllImport("__Internal")]`. The scene's UI buttons are linked to these functions to control the tracking process.

### Entity Spawning (C#)

The `EntitySpawner.cs` script allows users to spawn cubes in the scene to simulate load on the device. This can help in observing how increased workload affects CPU, GPU, and RAM usage.

## Known Issues

- **App Store Rejection**: The current implementation uses a third-party library for GPU monitoring, which may result in App Store rejection due to the usage of IOKit methods.
- **Compatibility**: Ensure compatibility with the latest versions of Unity and Xcode. Future updates to iOS or Unity may require changes to the plugin.


## Common Issues and Fixes

### Issue: `No such file or directory` Error When Building `PerformanceMonitor` Framework

Some users may encounter the following error when attempting to build the `PerformanceMonitor` framework in Xcode:
/Users/yourusername/Library/Developer/Xcode/DerivedData/PerformanceMonitor-<random_string>/Build/Products/Debug-iphoneos/GPUUtilization.framework: No such file or directory


#### Cause:

This error occurs when Xcode is unable to locate the `GPUUtilization.framework` in the expected directory.

#### Fix:

1. Open Finder and navigate to the following directory:

/Users/yourusername/Library/Developer/Xcode/DerivedData/PerformanceMonitor-<random_string>/Build/Products/Debug-iphoneos/GPUUtilization/


Replace `yourusername` and `<random_string>` with your actual macOS username and the appropriate folder name generated by Xcode.

2. Locate the `GPUUtilization.framework` inside the `GPUUtilization/` folder.

3. Manually drag the `GPUUtilization.framework` into the `Debug-iphoneos` directory.

4. Rebuild the `PerformanceMonitor` framework in Xcode.

5. Once successfully built, copy the `PerformanceMonitor.framework` from:

/Users/yourusername/Library/Developer/Xcode/DerivedData/PerformanceMonitor-<random_string>/Build/Products/Debug-iphoneos/PerformanceMonitor.framework

to your Unity project's `Assets/Plugins/iOS/` folder.

6. Rebuild the Unity project and deploy it to an iOS device.

## Acknowledgments

- The GPU monitoring functionality utilizes [GPUUtilization](https://github.com/rickytan/GPUUtilization).